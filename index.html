<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Dashboard PIB Municipal RS</title>

  <!-- Bootstrap (tabs, layout) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

  <!-- PapaParse (CSV) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <link rel="stylesheet" href="assets/style.css">
</head>

<body>
<div class="container-fluid py-3">

  <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
    <div>
      <h4 class="m-0">Dashboard PIB Municipal — RS</h4>
      <div class="text-muted small">Mapas + rankings + séries temporais (GitHub Pages) — <b>preços correntes (nominal)</b></div>
    </div>

    <div class="d-flex gap-2">
      <button id="btnReload" class="btn btn-outline-secondary btn-sm">Recarregar dados</button>
    </div>
  </div>

  <hr class="my-3"/>

  <!-- Tabs -->
  <ul class="nav nav-tabs" id="mainTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-panorama" data-bs-toggle="tab" data-bs-target="#pane-panorama" type="button" role="tab">
        Panorama
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-municipios" data-bs-toggle="tab" data-bs-target="#pane-municipios" type="button" role="tab">
        Municípios
      </button>
    </li>
  </ul>

  <div class="tab-content pt-3">

    <!-- ===================== PANORAMA ===================== -->
    <div class="tab-pane fade show active" id="pane-panorama" role="tabpanel">

      <div class="row g-3">
        <div class="col-12">
          <div class="card p-3">
            <div class="d-flex flex-wrap gap-2 align-items-end">
              <div class="ctrl">
                <label class="form-label">Variável</label>
                <select id="selVar" class="form-select form-select-sm"></select>
              </div>
              <div class="ctrl">
                <label class="form-label">Top N (race/ranking)</label>
                <input id="inpTopN" type="number" class="form-control form-control-sm" min="5" max="50" step="1" value="15"/>
              </div>

              <div class="ctrl">
                <label class="form-label">Ano (ranking)</label>
                <select id="selAnoRanking" class="form-select form-select-sm"></select>
              </div>

              <div class="ms-auto d-flex gap-2">
                <button id="btnUpdatePanorama" class="btn btn-primary btn-sm">Atualizar</button>
                <button id="btnWordRanking" class="btn btn-outline-primary btn-sm">Salvar Word (Ranking)</button>
              </div>
            </div>

            <div class="small text-muted mt-2" id="statusPanorama">Carregando…</div>
          </div>
        </div>

        <div class="col-12 col-xl-7">
          <div class="card p-2">
            <div class="chartTitle">Mapa animado</div>
            <div id="divMap" class="chartBox"></div>
          </div>
        </div>

        <div class="col-12 col-xl-5">
          <div class="card p-2">
            <div class="chartTitle">Bar chart race (Top N por ano)</div>
            <div id="divRace" class="chartBox"></div>
          </div>
        </div>

        <div class="col-12">
          <div class="card p-3">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
              <div class="chartTitle m-0">Ranking (Top N do ano selecionado)</div>
              <div class="text-muted small" id="rankingMeta"></div>
            </div>
            <div class="table-responsive mt-2">
              <table class="table table-sm table-striped align-middle" id="tblRanking">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Município</th>
                    <th>Código</th>
                    <th class="text-end">Valor</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ===================== MUNICÍPIOS ===================== -->
    <div class="tab-pane fade" id="pane-municipios" role="tabpanel">

      <div class="row g-3">
        <div class="col-12">
          <div class="card p-3">
            <div class="d-flex flex-wrap gap-2 align-items-end">
              <div class="ctrl">
                <label class="form-label">Variável</label>
                <select id="selVar2" class="form-select form-select-sm"></select>
              </div>
              <div class="ctrl">
                <label class="form-label">Buscar município</label>
                <input id="inpSearchMuni" class="form-control form-control-sm" placeholder="ex.: porto alegre"/>
              </div>

              <div class="ctrl ctrlTall">
                <label class="form-label">Municípios (Ctrl/Shift pra múltiplos)</label>
                <select id="selMunis" class="form-select form-select-sm" multiple></select>
              </div>

              <div class="ms-auto d-flex gap-2">
                <button id="btnUpdateSeries" class="btn btn-primary btn-sm">Atualizar</button>
                <button id="btnWordSeries" class="btn btn-outline-primary btn-sm">Salvar Word (Série)</button>
              </div>
            </div>

            <div class="d-flex gap-3 align-items-center mt-2 flex-wrap">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="chkMeanYear" />
                <label class="form-check-label small" for="chkMeanYear">Mostrar média anual (selecionados)</label>
              </div>
              <div class="small text-muted" id="statusSeries"></div>
            </div>
          </div>
        </div>

        <div class="col-12">
          <div class="card p-2">
            <div class="chartTitle">Série temporal</div>
            <div id="divSeries" class="chartBoxTall"></div>
          </div>
        </div>

        <div class="col-12">
          <div class="card p-3">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
              <div class="chartTitle m-0">Valores (lista)</div>
              <div class="text-muted small" id="seriesMeta"></div>
            </div>

            <div class="table-responsive mt-2">
              <table class="table table-sm table-striped align-middle" id="tblSeries">
                <thead>
                  <tr>
                    <th>Ano</th>
                    <th>Município</th>
                    <th>Código</th>
                    <th class="text-end">Valor</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

          </div>
        </div>

      </div>
    </div>

  </div><!-- tab-content -->

  <!-- Fonte -->
  <hr class="my-4"/>
  <footer class="pb-3">
    <div class="text-muted small">
      <b>Fonte:</b> Produto Interno Bruto dos Municípios — IBGE (2025). Disponível em:
      <a href="https://www.ibge.gov.br/estatisticas/economicas/contas-nacionais/9088-produto-interno-bruto-dos-municipios.html?=&t=resultados"
         target="_blank" rel="noopener noreferrer">página do IBGE</a>.
    </div>
  </footer>

</div><!-- container -->

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/app.js"></script>
</body>
</html>
